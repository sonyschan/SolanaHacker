import{P as te,T as he}from"./index.browser.esm-B0GrH2t9.js";import{b as ne}from"./index-Ckuz3vaH.js";import{W as re,h as m,g as Ee,c as W,b as _e,e as oe}from"./adapter-Bdk-Hy2w.js";import"./index-CTQr_OER.js";import"./index-CSdy_MG3.js";import"./index-Do4OYDqa.js";var A;(function(r){r.PROJECT_APPROVED="PROJECT_APPROVED",r.HANDSHAKE="HANDSHAKE",r.HANDSHAKE_ACK="HANDSHAKE_ACK",r.SIGNED_TRANSACTION="SIGNED_TRANSACTION",r.SIGNED_PARTIAL_TRANSACTION="SIGNED_PARTIAL_TRANSACTION",r.FAILED_TO_SIGN_TRANSACTION="FAILED_TO_SIGN_TRANSACTION",r.TRANSACTION_DENIED="TRANSACTION_DENIED",r.SOLANA_WALLET_ADAPTER_APPROVED="SOLANA_WALLET_ADAPTER_APPROVED",r.SOLANA_WALLET_ADAPTER_DENIED="SOLANA_WALLET_ADAPTER_DENIED",r.POPUP_CLOSED="POPUP_CLOSED",r.TRANSACTION_SIGNATURE_NEEDED="TRANSACTION_SIGNATURE_NEEDED",r.TRANSACTION_SIGNATURE_NEEDED_RESPONSE="TRANSACTION_SIGNATURE_NEEDED_RESPONSE",r.AUTH_LOADED="AUTH_LOADED",r.MESSAGE_SIGNATURE_NEEDED="MESSAGE_SIGNATURE_NEEDED",r.MESSAGE_SIGNATURE_NEEDED_RESPONSE="MESSAGE_SIGNATURE_NEEDED_RESPONSE",r.ONRAMP_FULFILLMENT_COMPLETE="ONRAMP_FULFILLMENT_COMPLETE",r.ONRAMP_REJECTED="ONRAMP_REJECTED"})(A||(A={}));var x;(function(r){r.UNKNOWN="UNKNOWN",r.REACT_SDK="REACT_SDK",r.SOLANA_WALLET_ADAPTER="SOLANA_WALLET_ADAPTER"})(x||(x={}));class Ae{constructor(o,n){this.validatedOrigin=o,this.targetWindow=n,this.handlers=new Map}off(o,n){const i=this.handlers.get(o);i?.delete(n)}on(o,n){var i;const f=(i=this.handlers.get(o))!==null&&i!==void 0?i:new Set;f.add(n),this.handlers.set(o,f)}send({event:o,payload:n}){this.targetWindow.postMessage({event:o,payload:n},this.validatedOrigin)}runHandlersForEvent(o,n){const i=this.handlers.get(o);if(i)for(const f of i)f(n)}resetHandlers(){this.handlers.clear()}export(){return{off:this.off.bind(this),on:this.on.bind(this),send:this.send.bind(this),validatedOrigin:this.validatedOrigin}}}const Se="https://fractal.is",ye="https://www.fractal.is",Te=400,C=600;function Ne(r){return r===ye||r===Se}const ge="fractal:approval:popup",we=["resizable","scrollbars=1","status=1"];function Re({left:r=0,scope:o=window,top:n=0,width:i=C,height:f=C,url:S}){return o.open(S,ge,Oe({height:f,left:r,top:n,width:i}))}function Oe({height:r,left:o,top:n,width:i}){return["popup",`left=${o}`,`top=${n}`,`width=${i}`,`height=${r}`,...we].join(",")}class Pe{constructor(o){this.platform=o,this.connection=null,this.popupWindow=null,this.handleMessage=n=>{var i,f;if(!Ne(n.origin))return;const S=n.origin;if(this.popupWindow){if(n.data.event===A.HANDSHAKE&&!this.connection){if(!this.verifyAndResetNonce((i=n.data.payload)===null||i===void 0?void 0:i.nonce))return;this.popupWindow.postMessage({event:A.HANDSHAKE_ACK,payload:{platform:this.platform}},S),this.connection=new Ae(S,this.popupWindow),(f=this.connectionUpdatedCallback)===null||f===void 0||f.call(this,this.connection)}this.connection&&(this.connection.runHandlersForEvent(n.data.event,n.data.payload),n.data.event===A.POPUP_CLOSED&&this.connection&&(this.resetConnection(),this.popupWindow=null))}}}initialize(){return window.addEventListener("message",this.handleMessage),this}tearDown(){return window.removeEventListener("message",this.handleMessage),this.resetConnection(),this}async open({url:o,widthPx:n=Te,heightPx:i=C,nonce:f}){var S;if(!((S=this.popupWindow)===null||S===void 0)&&S.closed&&this.resetConnectionAndPopupWindow(),this.popupWindow)return;this.initialize(),f&&(this.nonce=f);const g=window.screenX+(window.innerWidth-n)/2,w=window.screenY+(window.innerHeight-i)/2;this.popupWindow=Re({height:i,left:g,top:w,url:typeof o=="string"?o:void 0,width:n}),o instanceof Promise&&this.setUrl(await o)}close(){this.popupWindow&&(this.popupWindow.close(),this.resetConnectionAndPopupWindow())}onConnectionUpdated(o){return this.connectionUpdatedCallback=o,this}getConnection(){return this.connection}setUrl(o){this.popupWindow&&(this.popupWindow.location=o)}resetConnectionAndPopupWindow(){this.resetConnection(),this.popupWindow=null}resetConnection(){var o,n;(o=this.connection)===null||o===void 0||o.resetHandlers(),this.connection=null,(n=this.connectionUpdatedCallback)===null||n===void 0||n.call(this,this.connection)}verifyAndResetNonce(o){if(!this.nonce)return!0;const n=o===this.nonce;return n&&(this.nonce=void 0),n}}var $={exports:{}},s={},ie;function De(){if(ie)return s;ie=1;var r=Symbol.for("react.element"),o=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),g=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),a=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),R=Symbol.iterator;function ce(e){return e===null||typeof e!="object"?null:(e=R&&e[R]||e["@@iterator"],typeof e=="function"?e:null)}var B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,q={};function O(e,t,u){this.props=e,this.context=t,this.refs=q,this.updater=u||B}O.prototype.isReactComponent={},O.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},O.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function J(){}J.prototype=O.prototype;function I(e,t,u){this.props=e,this.context=t,this.refs=q,this.updater=u||B}var L=I.prototype=new J;L.constructor=I,V(L,O.prototype),L.isPureReactComponent=!0;var z=Array.isArray,X=Object.prototype.hasOwnProperty,M={current:null},Y={key:!0,ref:!0,__self:!0,__source:!0};function Q(e,t,u){var d,l={},h=null,_=null;if(t!=null)for(d in t.ref!==void 0&&(_=t.ref),t.key!==void 0&&(h=""+t.key),t)X.call(t,d)&&!Y.hasOwnProperty(d)&&(l[d]=t[d]);var E=arguments.length-2;if(E===1)l.children=u;else if(1<E){for(var p=Array(E),N=0;N<E;N++)p[N]=arguments[N+2];l.children=p}if(e&&e.defaultProps)for(d in E=e.defaultProps,E)l[d]===void 0&&(l[d]=E[d]);return{$$typeof:r,type:e,key:h,ref:_,props:l,_owner:M.current}}function le(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function b(e){return typeof e=="object"&&e!==null&&e.$$typeof===r}function de(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(u){return t[u]})}var Z=/\/+/g;function U(e,t){return typeof e=="object"&&e!==null&&e.key!=null?de(""+e.key):t.toString(36)}function P(e,t,u,d,l){var h=typeof e;(h==="undefined"||h==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(h){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case r:case o:_=!0}}if(_)return _=e,l=l(_),e=d===""?"."+U(_,0):d,z(l)?(u="",e!=null&&(u=e.replace(Z,"$&/")+"/"),P(l,t,u,"",function(N){return N})):l!=null&&(b(l)&&(l=le(l,u+(!l.key||_&&_.key===l.key?"":(""+l.key).replace(Z,"$&/")+"/")+e)),t.push(l)),1;if(_=0,d=d===""?".":d+":",z(e))for(var E=0;E<e.length;E++){h=e[E];var p=d+U(h,E);_+=P(h,t,u,p,l)}else if(p=ce(e),typeof p=="function")for(e=p.call(e),E=0;!(h=e.next()).done;)h=h.value,p=d+U(h,E++),_+=P(h,t,u,p,l);else if(h==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return _}function D(e,t,u){if(e==null)return e;var d=[],l=0;return P(e,d,"","",function(h){return t.call(u,h,l++)}),d}function fe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(u){(e._status===0||e._status===-1)&&(e._status=1,e._result=u)},function(u){(e._status===0||e._status===-1)&&(e._status=2,e._result=u)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var T={current:null},v={transition:null},pe={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:v,ReactCurrentOwner:M};function ee(){throw Error("act(...) is not supported in production builds of React.")}return s.Children={map:D,forEach:function(e,t,u){D(e,function(){t.apply(this,arguments)},u)},count:function(e){var t=0;return D(e,function(){t++}),t},toArray:function(e){return D(e,function(t){return t})||[]},only:function(e){if(!b(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},s.Component=O,s.Fragment=n,s.Profiler=f,s.PureComponent=I,s.StrictMode=i,s.Suspense=a,s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pe,s.act=ee,s.cloneElement=function(e,t,u){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var d=V({},e.props),l=e.key,h=e.ref,_=e._owner;if(t!=null){if(t.ref!==void 0&&(h=t.ref,_=M.current),t.key!==void 0&&(l=""+t.key),e.type&&e.type.defaultProps)var E=e.type.defaultProps;for(p in t)X.call(t,p)&&!Y.hasOwnProperty(p)&&(d[p]=t[p]===void 0&&E!==void 0?E[p]:t[p])}var p=arguments.length-2;if(p===1)d.children=u;else if(1<p){E=Array(p);for(var N=0;N<p;N++)E[N]=arguments[N+2];d.children=E}return{$$typeof:r,type:e.type,key:l,ref:h,props:d,_owner:_}},s.createContext=function(e){return e={$$typeof:g,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:S,_context:e},e.Consumer=e},s.createElement=Q,s.createFactory=function(e){var t=Q.bind(null,e);return t.type=e,t},s.createRef=function(){return{current:null}},s.forwardRef=function(e){return{$$typeof:w,render:e}},s.isValidElement=b,s.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:fe}},s.memo=function(e,t){return{$$typeof:c,type:e,compare:t===void 0?null:t}},s.startTransition=function(e){var t=v.transition;v.transition={};try{e()}finally{v.transition=t}},s.unstable_act=ee,s.useCallback=function(e,t){return T.current.useCallback(e,t)},s.useContext=function(e){return T.current.useContext(e)},s.useDebugValue=function(){},s.useDeferredValue=function(e){return T.current.useDeferredValue(e)},s.useEffect=function(e,t){return T.current.useEffect(e,t)},s.useId=function(){return T.current.useId()},s.useImperativeHandle=function(e,t,u){return T.current.useImperativeHandle(e,t,u)},s.useInsertionEffect=function(e,t){return T.current.useInsertionEffect(e,t)},s.useLayoutEffect=function(e,t){return T.current.useLayoutEffect(e,t)},s.useMemo=function(e,t){return T.current.useMemo(e,t)},s.useReducer=function(e,t,u){return T.current.useReducer(e,t,u)},s.useRef=function(e){return T.current.useRef(e)},s.useState=function(e){return T.current.useState(e)},s.useSyncExternalStore=function(e,t,u){return T.current.useSyncExternalStore(e,t,u)},s.useTransition=function(){return T.current.useTransition()},s.version="18.3.1",s}var se;function ve(){return se||(se=1,$.exports=De()),$.exports}ve();function F(r){return!(r===null||typeof r!="object")}function me(r){return!(!F(r)||!("solanaPublicKey"in r)||typeof r.solanaPublicKey!="string")}function Ce(r){return!F(r)||!("signedB58Transactions"in r)||!Array.isArray(r.signedB58Transactions)?!1:r.signedB58Transactions.every(o=>typeof o=="string")}function Ie(r){return!F(r)||!("decodedSignature"in r)?!1:typeof r.decodedSignature=="string"}function G(){return`${k()}${k()}${k()}`}function k(){return(Math.random()+1).toString(36).substring(7)}const H="Unknown Error",j="https://fractal.is",Le=`${j}/wallet-adapter/approve`,Me=`${j}/wallet-adapter/sign`,be=`${j}/wallet-adapter/sign/message`,ae=C,ue=850,K="RdxqNYxF";class Ke{constructor(){this.popupManager=new Pe(x.SOLANA_WALLET_ADAPTER),this.publicKey=null,this.connecting=!1}getPublicKey(){return this.publicKey}async connect(){let o,n;const i=window.localStorage.getItem(K);if(i)return this.publicKey=new te(i),Promise.resolve();const f=G();this.popupManager.open({nonce:f,url:`${Le}/${f}`});const S=a=>{if(!me(a)){n(new W(`Malformed payload when setting up connection. Expected { solanaPublicKey: string } but received ${JSON.stringify(a)}`)),this.popupManager.close();return}try{this.publicKey=new te(a.solanaPublicKey),window.localStorage.setItem(K,a.solanaPublicKey),o()}catch(c){const y=new _e(c instanceof Error?c.message:H,c);n(y)}this.popupManager.close()},g=()=>{n(new W("The user denied the connection.")),this.popupManager.close()},w=()=>{n(new W("The user denied the connection.")),this.popupManager.close()};return this.popupManager.onConnectionUpdated(a=>{a&&(a.on(A.SOLANA_WALLET_ADAPTER_APPROVED,S),a.on(A.SOLANA_WALLET_ADAPTER_DENIED,g),a.on(A.POPUP_CLOSED,w))}),new Promise((a,c)=>{o=a,n=c})}async disconnect(){this.popupManager.tearDown(),this.publicKey=null,window.localStorage.removeItem(K)}async signTransaction(o){try{return this.checkWalletReadiness(),(await this.signTransactions([o]))[0]}catch(n){let i=n;throw n instanceof re||(i=new m(n instanceof Error?n.message:H,n)),i}}async signAllTransactions(o){try{return this.checkWalletReadiness(),await this.signTransactions(o)}catch(n){let i=n;throw n instanceof re||(i=new m(n instanceof Error?n.message:H,n)),i}}async signMessage(o){const n=new TextDecoder().decode(o);let i,f;const S=c=>{if(!Ie(c)){const R=new oe(`Malformed payload when signing message. Expected { decodedSignature: string } but received ${JSON.stringify(c)}`);f(R),this.popupManager.close();return}const y=Uint8Array.from(c.decodedSignature.split(",").map(R=>Number(R)));i(y),this.popupManager.close()},g=()=>{f(new oe("The user did not approve the message")),this.popupManager.close()},w=()=>{var c;const y={decodedMessage:n};(c=this.popupManager.getConnection())===null||c===void 0||c.send({event:A.MESSAGE_SIGNATURE_NEEDED,payload:y})},a=G();return this.popupManager.open({heightPx:Math.max(ae,Math.floor(window.innerHeight*.8)),nonce:a,url:`${be}/${a}`,widthPx:Math.min(ue,Math.floor(window.innerWidth*.8))}),this.popupManager.onConnectionUpdated(c=>{c&&(c.on(A.MESSAGE_SIGNATURE_NEEDED_RESPONSE,S),c.on(A.TRANSACTION_DENIED,g),c.on(A.POPUP_CLOSED,g),c.on(A.AUTH_LOADED,w))}),new Promise((c,y)=>{i=c,f=y})}async signTransactions(o){let n,i;const f=a=>{if(!Ce(a)){const y=new m(`Malformed payload when signing transactions. Expected { signedB58Transactions: string[] } but received ${JSON.stringify(a)}`);i(y),this.popupManager.close();return}const c=a.signedB58Transactions.map(y=>he.from(ne.decode(y)));n(c),this.popupManager.close()},S=()=>{i(new m("The user did not approve the transaction")),this.popupManager.close()},g=()=>{var a;const c={unsignedB58Transactions:o.map(y=>ne.encode(y.serializeMessage()))};(a=this.popupManager.getConnection())===null||a===void 0||a.send({event:A.TRANSACTION_SIGNATURE_NEEDED,payload:c})},w=G();return this.popupManager.open({heightPx:Math.max(ae,Math.floor(window.innerHeight*.8)),nonce:w,url:`${Me}/${w}`,widthPx:Math.min(ue,Math.floor(window.innerWidth*.8))}),this.popupManager.onConnectionUpdated(a=>{a&&(a.on(A.TRANSACTION_SIGNATURE_NEEDED_RESPONSE,f),a.on(A.TRANSACTION_DENIED,S),a.on(A.POPUP_CLOSED,S),a.on(A.AUTH_LOADED,g))}),new Promise((a,c)=>{n=a,i=c})}checkWalletReadiness(){if(this.publicKey===null)throw new Ee("`publicKey` is null. Did you forget to call `.connect()`?")}}export{Ke as FractalWalletAdapterImpl};
